<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.stocklab_service.mapper.PlatformServiceMapper">

    <!-- 结果映射 -->
    <resultMap id="PlatformServiceResultMap" type="com.example.stocklab_service.entity.PlatformService">
        <id property="id" column="id"/>
        <result property="serviceCode" column="service_code"/>
        <result property="serviceName" column="service_name"/>
        <result property="serviceDescription" column="service_description"/>
        <result property="serviceType" column="service_type"/>
        <result property="iconName" column="icon_name"/>
        <result property="colorClass" column="color_class"/>
        <result property="serviceUrl" column="service_url"/>
        <result property="urlType" column="url_type"/>
        <result property="otherInformation" column="other_information"/>
        <result property="sortOrder" column="sort_order"/>
        <result property="isVisible" column="is_visible"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id, service_code, service_name, service_description, service_type, icon_name, 
        color_class, service_url, url_type, other_information, sort_order, is_visible, 
        created_at, updated_at
    </sql>

    <!-- 根据ID查询平台服务 -->
    <select id="selectById" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE id = #{id}
    </select>

    <!-- 根据服务代码查询平台服务 -->
    <select id="selectByServiceCode" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE service_code = #{serviceCode}
    </select>

    <!-- 查询所有平台服务 -->
    <select id="selectAll" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 根据服务类型查询平台服务 -->
    <select id="selectByServiceType" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE service_type = #{serviceType}
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 根据可见状态查询平台服务 -->
    <select id="selectByIsVisible" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE is_visible = #{isVisible}
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 根据URL类型查询平台服务 -->
    <select id="selectByUrlType" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE url_type = #{urlType}
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 查询可见的平台服务，按排序权重排序 -->
    <select id="selectVisibleOrderBySortOrder" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE is_visible = 1
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 根据服务类型查询可见的平台服务，按排序权重排序 -->
    <select id="selectVisibleByServiceTypeOrderBySortOrder" resultMap="PlatformServiceResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM platform_services
        WHERE is_visible = 1 AND service_type = #{serviceType}
        ORDER BY sort_order ASC, created_at DESC
    </select>

    <!-- 插入平台服务 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO platform_services (
            service_code, service_name, service_description, service_type, icon_name,
            color_class, service_url, url_type, other_information, sort_order, is_visible
        )
        VALUES (
            #{serviceCode}, #{serviceName}, #{serviceDescription}, #{serviceType}, #{iconName},
            #{colorClass}, #{serviceUrl}, #{urlType}, #{otherInformation}, #{sortOrder}, #{isVisible}
        )
    </insert>

    <!-- 更新平台服务信息 -->
    <update id="updateById">
        UPDATE platform_services
        SET service_code = #{serviceCode},
            service_name = #{serviceName},
            service_description = #{serviceDescription},
            service_type = #{serviceType},
            icon_name = #{iconName},
            color_class = #{colorClass},
            service_url = #{serviceUrl},
            url_type = #{urlType},
            other_information = #{otherInformation},
            sort_order = #{sortOrder},
            is_visible = #{isVisible}
        WHERE id = #{id}
    </update>

    <!-- 更新可见状态 -->
    <update id="updateIsVisible">
        UPDATE platform_services
        SET is_visible = #{isVisible}
        WHERE id = #{id}
    </update>

    <!-- 更新排序权重 -->
    <update id="updateSortOrder">
        UPDATE platform_services
        SET sort_order = #{sortOrder}
        WHERE id = #{id}
    </update>

    <!-- 根据ID删除平台服务 -->
    <delete id="deleteById">
        DELETE FROM platform_services
        WHERE id = #{id}
    </delete>

    <!-- 根据服务代码删除平台服务 -->
    <delete id="deleteByServiceCode">
        DELETE FROM platform_services
        WHERE service_code = #{serviceCode}
    </delete>

    <!-- 统计平台服务总数 -->
    <select id="count" resultType="int">
        SELECT COUNT(*)
        FROM platform_services
    </select>

    <!-- 根据服务类型统计 -->
    <select id="countByServiceType" resultType="int">
        SELECT COUNT(*)
        FROM platform_services
        WHERE service_type = #{serviceType}
    </select>

    <!-- 根据服务代码统计 -->
    <select id="countByServiceCode" resultType="int">
        SELECT COUNT(*)
        FROM platform_services
        WHERE service_code = #{serviceCode}
    </select>

</mapper>